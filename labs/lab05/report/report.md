---
## Front matter
title: "Отчёт по лабораторной работе 4"
subtitle: "Базовая настройка HTTP-сервера Apache"
author: "Чилеше Лупупа"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и базовому конфигурированию HTTP-сервера Apache.

# Выполнение работы

## Установка и базовая настройка HTTP-сервера

После запуска виртуальной машины **server** и перехода в режим суперпользователя был установлен стандартный набор компонентов *Basic Web Server*, включающий HTTP-сервер Apache, утилиты и дополнительные модули.  
По завершении установки были просмотрены каталоги конфигурации `/etc/httpd/conf` и `/etc/httpd/conf.d`, содержащие основные и включаемые настройки веб-сервера.

![Просмотр конфигурационных каталогов httpd](Screenshot_1.png){ #fig:001 width=80% }

Каталог `/etc/httpd/conf` содержит основной файл `httpd.conf`, определяющий параметры работы сервера.  
Каталог `/etc/httpd/conf.d` включает модульные конфигурации, такие как управление индексами, SSL-параметры, настройки пользовательских директорий и вспомогательные модули.

## Разрешение HTTP-трафика в межсетевом экране

Для обеспечения работы веб-сервера в межсетевом экране были добавлены разрешения на сервис `http` как временно, так и на постоянной основе. После обновления конфигурации сервис стал доступен для входящих соединений.

![Настройка firewalld для разрешения HTTP-сервиса](Screenshot_2.png){ #fig:002 width=80% }

## Запуск службы HTTP-сервера

В дополнительном терминале был активирован мониторинг системных сообщений. После этого веб-сервер был включён в автозагрузку и запущен.  
Просмотр расширенного журнала показал корректный запуск всех модулей Apache и отсутствие ошибок.

## Проверка работы HTTP-сервера

На виртуальной машине **client** был открыт браузер, после чего в адресной строке был введён IP-адрес сервера `192.168.1.1`.  
Тестовая страница HTTP-сервера Rocky Linux отобразилась успешно, что подтверждает корректную работу сервиса.

![Отображение тестовой страницы HTTP-сервера](Screenshot_3.png){ #fig:003 width=80% }

## Анализ логов работы веб-сервера

На виртуальной машине **server** были просмотрены журналы `error_log` и `access_log`.  
В журнале ошибок отражены события запуска сервера и активации используемых модулей.  
В журнале доступа отображены запросы от клиентской машины, включая обращение к корневой странице и статическим ресурсам.

![Просмотр логов error_log и access_log](Screenshot_4.png){ #fig:004 width=80% }

По данным журнала доступа видно, что браузер клиента корректно запросил страницу по адресу `192.168.1.1`, а сервер успешно обработал эти обращения, что подтверждает полноценную работу HTTP-сервера.

# Настройка виртуального хостинга для HTTP-сервера

## Добавление записей в DNS-зоны

Перед внесением изменений DNS-сервер был остановлен. В прямую зону были добавлены новые A-записи для `www.chileshe.net`, а в обратную зону — PTR-запись для соответствующего IP-адреса.

![Файл прямой DNS-зоны](Screenshot_5.png){ #fig:005 width=80% }

![Файл обратной DNS-зоны](Screenshot_6.png){ #fig:006 width=80% }

После удаления файлов журналов зон и сохранения изменений DNS-сервер был вновь запущен.

## Создание конфигураций виртуальных хостов

В каталоге `/etc/httpd/conf.d` были созданы два конфигурационных файла: `server.chileshe.net.conf` и `www.chileshe.net.conf`.  
В каждый файл добавлено описание виртуального хоста.

### Конфигурация server.chileshe.net

![Конфигурационный файл server.chileshe.net.conf](Screenshot_7.png){ #fig:007 width=80% }

### Конфигурация www.chileshe.net

![Конфигурационный файл www.chileshe.net.conf](Screenshot_8.png){ #fig:008 width=80% }

## Создание каталога и тестовых страниц веб-сайтов

В каталоге `/var/www/html` были созданы директории для каждого виртуального хоста.  
Для `server.chileshe.net` и `www.chileshe.net` подготовлены тестовые страницы `index.html`.

![Создание каталогов и HTML-файлов](Screenshot_9.png){ #fig:009 width=80% }

Права доступа к каталогу веб-контента были скорректированы, а SELinux-контекст восстановлен.

После выполнения настроек HTTP-сервер был перезапущен.

## Проверка работы виртуальных хостов

### Доступ к server.chileshe.net

![Проверка server.chileshe.net](Screenshot_10.png){ #fig:010 width=80% }

### Доступ к www.chileshe.net

![Проверка www.chileshe.net](Screenshot_11.png){ #fig:011 width=80% }

Обе страницы успешно открываются с клиентской виртуальной машины, что подтверждает корректную работу виртуального хостинга.

## Обновление внутреннего окружения виртуальной машины

Все изменённые конфигурационные файлы были перенесены в структуру `/vagrant/provision/server/http/`, где подготовлены каталоги для хранения настроек Apache и веб-контента. Также были обновлены файлы DNS-зон в каталоге `/vagrant/provision/server/dns/var/named/`.

В каталоге `/vagrant/provision/server` был создан исполняемый скрипт `http.sh`, включающий установку необходимых пакетов, копирование файлов конфигурации, настройку SELinux, прав доступа, межсетевого экрана и запуск службы HTTP-сервера.

![Скрипт http.sh](Screenshot_12.png){ #fig:012 width=80% }

# Вывод

В ходе работы был настроен виртуальный хостинг на базе Apache, включая обновление DNS-зон, создание конфигураций виртуальных хостов и размещение веб-контента. DNS-сервер корректно обрабатывает доменные имена, а Apache обслуживает сайты `server.chileshe.net` и `www.chileshe.net`. Проверка с клиентской машины подтвердила доступность обоих ресурсов. Все компоненты — DNS, виртуальные хосты и веб-контент — функционируют согласованно, обеспечивая стабильную работу веб-службы.

# Контрольные вопросы

**1. Через какой порт по умолчанию работает Apache?**
По умолчанию веб-сервер Apache использует порт **80** для работы по протоколу HTTP. При использовании HTTPS подключение осуществляется через порт **443**, однако данный порт активен только при включении модуля `mod_ssl` и наличии SSL-сертификатов.

**2. Под каким пользователем запускается Apache и к какой группе относится этот пользователь?**
В типичных конфигурациях Linux (включая Rocky Linux) службы Apache работают от имени системного пользователя **apache**, который входит в одноимённую группу **apache**. Это разделяет процессы веб-сервера от других компонентов системы и снижает риск выполнения операций с избыточными привилегиями.

**3. Где располагаются лог-файлы веб-сервера? Что можно по ним отслеживать?**
По умолчанию журналы Apache находятся в каталоге **/var/log/httpd/**.
Основные файлы:

* `access_log` — содержит информацию о запросах клиентов (источник запроса, URL, код ответа, User-Agent). Позволяет анализировать активность пользователей, выявлять ошибки или попытки несанкционированного доступа.
* `error_log` — фиксирует ошибки работы веб-сервера, проблемы с конфигурацией, сбои модулей и скриптов. Используется для диагностики и устранения неисправностей.

**4. Где по умолчанию содержится контент веб-серверов?**
Стандартный каталог, содержащий веб-контент Apache, находится по пути **/var/www/html/**.
Для виртуальных хостов создаются отдельные подкаталоги, соответствующие доменным именам, что позволяет разделять содержимое разных веб-сайтов.

**5. Каким образом реализуется виртуальный хостинг? Что он даёт?**
Виртуальный хостинг реализуется через конфигурационные файлы в каталоге **/etc/httpd/conf.d**, где для каждого доменного имени создаётся отдельный блок `<VirtualHost>`.
Виртуальный хост определяет: доменное имя (`ServerName`), корневой каталог сайта (`DocumentRoot`), файлы логов и другие параметры.

Такой механизм позволяет:

* размещать **несколько независимых сайтов** на одном физическом сервере;
* разделять их конфигурации и журналы;
* хранить контент каждого сайта в отдельном каталоге;
* использовать единый веб-сервер для обслуживания множества доменных имён.
