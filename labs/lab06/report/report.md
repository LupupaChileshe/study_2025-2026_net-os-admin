---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Установка и настройка системы управления базами данных MariaDB"
author: "Чилеше Лупупа"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию системы управления базами данных на примере программного обеспечения MariaDB.

# Выполнение работы

## Установка и первичная настройка MariaDB

### Установка необходимых пакетов

Для работы с системой управления базами данных были установлены пакеты `mariadb` и `mariadb-server`. После установки система вывела перечень компонентов, включая серверную часть, клиентские утилиты и дополнительные модули.

![Установка MariaDB](Screenshot_1.png){ #fig:001 width=80% }

### Просмотр конфигурационных файлов MariaDB

В каталоге `/etc/my.cnf.d` находятся конфигурационные файлы службы MariaDB, которые включаются основным файлом `/etc/my.cnf`. На изображении продемонстрировано содержимое каталога конфигурации:

Основной файл `my.cnf` включает общие настройки клиента и сервера:

**Построчный комментарий файла `/etc/my.cnf`:**

- `#` — строки комментариев, используемые для пояснений.  
- `This group is read both by the client and the server` — параметры из этой группы читаются и клиентами, и сервером.  
- `use it for options that affect everything` — рекомендуется помещать сюда глобальные настройки.  
- `[client-server]` — секция общих параметров.  
- `# include all files from the config directory` — пояснение о подключении дополнительных конфигов.  
- `!includedir /etc/my.cnf.d` — директива, подключающая содержимое каталога `/etc/my.cnf.d`.

### Запуск и включение службы MariaDB

После установки сервер был запущен и добавлен в автозагрузку. Завершение команд сопровождалось созданием симлинков на соответствующие unit-файлы.

### Проверка прослушивания порта MariaDB

Командой для анализа активных сетевых соединений было подтверждено, что процесс `mariadbd` слушает порт 3306.

## Настройка безопасности MariaDB

Для выполнения базовой конфигурации безопасности был запущен скрипт `mysql_secure_installation`. В ходе работы были выполнены следующие действия:

- установлен пароль пользователя root (MariaDB);
- отключён удалённый доступ root;
- удалены анонимные пользователи;
- удалена тестовая база данных;
- обновлены таблицы привилегий.

![mysql_secure_installation](Screenshot_2.png){ #fig:002 width=80% }

## Проверка доступных команд и системных баз данных

После входа в MariaDB (`mysql -u root -p`) был просмотрен список доступных команд (`\h`), а затем выполнен SQL-запрос для отображения доступных баз данных


Результат:

![Список баз данных](Screenshot_3.png){ #fig:003 width=80% }

**В системе доступны следующие базы данных:**

- `information_schema` — служебная база метаданных;  
- `mysql` — таблицы пользователей, прав и системных параметров;  
- `performance_schema` — статистика о работе сервера;  
- `sys` — представления для анализа производительности.

## Конфигурация кодировки символов

### Просмотр состояния MariaDB до изменений

Для анализа текущей конфигурации был выполнен просмотр статуса сервера:

![Статус MariaDB до изменения кодировки](Screenshot_4.png){ #fig:004 width=80% }

**Пояснение ключевых параметров:**

- *Server version* — версия MariaDB.  
- *Current user* — пользователь, от имени которого осуществляется соединение.  
- *SSL* — состояние SSL-соединения.  
- *Connection* — локальное соединение через UNIX-сокет.  
- *Server/Db/Client/Conn character set* — используемые кодировки.  
- *Uptime* — время работы службы.  
- *Threads, Questions, Slow queries* — статистика активности.

### Создание конфигурации кодировки

В каталоге `/etc/my.cnf.d` был создан файл `utf8.cnf` со следующим содержимым:


![Создание файла utf8.cnf](Screenshot_5.png){ #fig:005 width=80% }

### Перезапуск и проверка изменений

После перезапуска MariaDB был повторно просмотрен статус системы:

![Статус MariaDB после изменения кодировки](Screenshot_6.png){ #fig:006 width=80% }

**Изменения после применения конфигурации:**

- параметры `Server character set`, `Db character set`, `Client character set` и `Conn character set` изменились на `utf8mb3`;  
- сервер начал работу в корректной UTF-8-совместимой кодировке;  
- обновлённые параметры подтвердили успешное применение настроек.

# Создание базы данных и управление данными в MariaDB

### Создание базы данных addressbook

Для начала был выполнен вход в MariaDB с правами администратора. Затем была создана база данных `addressbook` с использованием кодировки UTF-8:

После создания база была выбрана для дальнейшей работы:

Так как база данных только создана, список таблиц оказался пустым.

### Создание таблицы city и заполнение данными

В базе данных была создана таблица `city` с двумя текстовыми полями:

После этого таблица была заполнена тремя строками:

- Иванов — Москва  
- Петров — Сочи  
- Сидоров — Дубна  

Для проверки данных был выполнен запрос:

![Результат SELECT * FROM city](Screenshot_7.png){ #fig:007 width=80% }

**Пояснение результата:**  
Запрос выводит все строки таблицы `city`. Таблица содержит три записи, каждая из которых включает имя и соответствующий город.

### Создание пользователя и назначение прав

Был создан пользователь `chileshe@'%'` и установлен пароль:

![Создание пользователя](Screenshot_8.png){ #fig:008 width=80% }

### Просмотр списка баз данных и таблиц

После выхода из MariaDB были просмотрены все базы данных:

![mysqlshow -u root -p](Screenshot_9.png){ #fig:009 width=80% }

Затем был выполнен просмотр таблиц базы addressbook

Обе команды подтвердили наличие таблицы `city`.

## Создание резервных копий базы данных

В системе был создан каталог для резервных копий:

![Создание каталога /var/backup](Screenshot_10.png){ #fig:020 width=80% }

Далее были выполнены следующие действия:

1. **Обычная резервная копия**

2. **Сжатая резервная копия**

3. **Сжатая копия с датой в имени файла**

4. **Восстановление из обычной копии**

5. **Восстановление из gzip-копии**

## Добавление конфигурации MariaDB в Vagrant-окружение

В каталоге `/vagrant/provision/server/` был создан подкаталог `mysql` и в него были помещены:

- конфигурационные файлы MariaDB;
- резервные копии базы данных.

Также был создан и сделан исполняемым файл `mysql.sh`, предназначенный для автоматизации установки и настройки MariaDB при развёртывании виртуальной машины:

![Содержимое mysql.sh](Screenshot_11.png){ #fig:011 width=80% }

# Вывод

В ходе работы была создана и настроена база данных MariaDB, включающая таблицу `city` и записи пользователей. Были продемонстрированы операции создания базы, таблиц, добавления данных, управления пользователями и привилегиями. Выполнены резервные копии базы данных в разных форматах и проверено корректное восстановление. Конфигурационные файлы и резервные копии интегрированы в инфраструктуру Vagrant для автоматизации последующих развертываний. Работа подтверждает корректность настройки MariaDB и выполнение всех требуемых операций.

# Контрольные вопросы

**1. Какая команда отвечает за настройки безопасности в MariaDB?**  
За выполнение первичной настройки безопасности отвечает команда  
`mysql_secure_installation`.  
Она позволяет задать пароль root, удалить анонимных пользователей, отключить удалённый вход root и удалить тестовую базу данных.

**2. Как настроить MariaDB для доступа через сеть?**  
Необходимо изменить параметр `bind-address` в конфигурации MariaDB:  
- указать `0.0.0.0`, чтобы разрешить подключение с любых адресов;  
- либо указать конкретный IP.  
После изменения — перезапустить службу MariaDB. Также пользователям должны быть выданы права вида `user@'%'` или `user@'<ip>'`.

**3. Какая команда позволяет получить обзор доступных баз данных после входа в среду оболочки MariaDB?**  
Команда:
```
SHOW DATABASES;
```
Она выводит перечень всех доступных пользователю баз данных.

**4. Какая команда позволяет узнать, какие таблицы доступны в базе данных?**  
Команда:
```
SHOW TABLES;
```

**5. Какая команда позволяет узнать, какие поля доступны в таблице?**  
Команда:
```
DESCRIBE имя_таблицы;
```
или короче:
```
DESC имя_таблицы;
```

**6. Какая команда позволяет узнать, какие записи доступны в таблице?**  
Команда:
```
SELECT * FROM имя_таблицы;
```

**7. Как удалить запись из таблицы?**  
Используется команда:
```
DELETE FROM имя_таблицы WHERE условие;
```
Например:
```
DELETE FROM city WHERE name='Петров';
```

**8. Где расположены файлы конфигурации MariaDB? Что можно настроить с их помощью?**  
Основные конфигурации находятся в каталоге:  
`/etc/my.cnf`  
и в директории:  
`/etc/my.cnf.d/`  

С их помощью можно настроить:
- параметры кодировки;
- пути к данным;
- сетевые параметры (порт, bind-address);
- настройки буферов и кешей;
- параметры клиентов и сервера.

**9. Где располагаются файлы с базами данных MariaDB?**  
Физические файлы баз данных по умолчанию находятся по пути:  
`/var/lib/mysql/`  
В этом каталоге каждая база представлена собственной директорией.

**10. Как сделать резервную копию базы данных и затем её восстановить?**  
Резервная копия создаётся командой:
```
mysqldump -u root -p база > файл.sql
```

Сжатая копия:
```
mysqldump -u root -p база | gzip > файл.sql.gz
```

Восстановление из обычного файла:
```
mysql -u root -p база < файл.sql
```

Восстановление из gzip-архива:
```
zcat файл.sql.gz | mysql -u root -p база
```
